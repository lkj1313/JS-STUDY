JavaScript는 싱글 스레드 언어로, 코드가 위에서 아래로 순차적으로 실행된다. 하지만 분명히 싱글스레드 언어인데도, 비동기 작업인 네트워크 요청, 타이머, 파일 읽기 등을 처리할 수 있다. 신기하지 않는가? 이처럼 JS가 비동기 작업을 효율적으로 다룰 수 있도록 돕는 중요한 메커니즘이 바로 이벤트 루프이다.

그렇다면 이벤트 루프는 어떻게 돌아가는 것일까? 이번 포스트에서는 이벤트 루프가 어떻게 돌아가는지 그 과정을 한번 정리 해 보겠다.


### 이벤트 루프가 돌아가는 과정
1. 비동기 함수호출
JavaScript 코드가 순차적으로 실행되다 보면 setTimeout, Promise, AJAX 요청과 같은 비동기 함수를 만날 때가 있다. 이때 해당 함수가 호출 스택(Call Stack)에 올라가 실행된다.

2. Web API로 작업 전달 및 실행
비동기 함수가 호출 스택에서 실행을 마치면, 비동기 작업은 Web API로 전달된다. Web API는 JavaScript 엔진 외부의 브라우저 환경에서 비동기 작업을 백그라운드에서 처리한다. 예를 들어, setTimeout 함수는 설정된 시간 동안 Web API에서 대기하다가 시간이 지나면 콜백을 콜백 큐로 보내기 위해 준비한다.

3. 콜백 함수가 대기 큐로 이동
비동기 작업이 완료되면, 해당 작업의 콜백 함수가 대기 큐로 이동한다. 콜백 함수는 작업의 종류에 따라 마이크로태스크 큐 또는 콜백 큐 중 하나에 들어간다.
Promise와 같은 작업은 마이크로태스크 큐에 들어가고, setTimeout과 같은 작업은 콜백 큐에 들어간다.

> #### 마이크로태스크 큐와 콜백 큐의 차이
1. 마이크로태스크 큐는 주로 Promise와 MutationObserver 같은 작업을 처리하고 콜백큐는 setTimeout, setInterval, 이벤트 리스너 같은 Web API가 완료 된 후 호출되는 일반적인 비동기 작업이 들어간다.
2. 이벤트 루프는 호출 스택이 비어있으면, 먼저 마이크로태스트 큐의 모든 작업을 우선적으로 처리한다.

4. 이벤트 루프가 호출 스택 상태 확인
이벤트 루프는 호출 스택이 비어 있는지 지속적으로 확인한다. 호출 스택이 비어 있는 상태라면, 대기 큐에서 다음 작업을 가져와 실행할 준비가 된 것이다.

5. 마이크로태스크 큐부터 실행
호출 스택이 비면 이벤트 루프는 마이크로태스크 큐를 먼저 확인한다. 마이크로태스크 큐에 작업이 있으면 이를 호출 스택으로 하나씩 이동시켜 실행한다. 모든 마이크로태스크 작업이 완료될 때까지 이 과정을 반복한다.

6. 콜백 큐 실행
마이크로태스크 큐가 비어 있으면, 이벤트 루프는 콜백 큐로 이동하여 대기 중인 작업이 있는지 확인한다. 콜백 큐의 작업을 호출 스택에 넣어 하나씩 순차적으로 실행한다.

7. 반복
이벤트 루프는 호출 스택이 비면 다시 마이크로태스크 큐와 콜백 큐를 번갈아 확인하고, 각 큐의 작업을 호출 스택으로 옮겨 실행합니다. 이 과정을 반복하면서 JavaScript는 비동기 작업을 효율적으로 처리할 수 있게 된다.

![](https://velog.velcdn.com/images/smm45108/post/dc1fad0e-dde3-4fc3-bdb6-bcac9c87c7b4/image.png)

(마이크로태스크 큐는 그림에 안나와있다...)


___
그림출처 : https://wikidocs.net/251900

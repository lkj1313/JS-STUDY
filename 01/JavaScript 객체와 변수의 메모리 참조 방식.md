JavaScript는 효율적인 메모리 관리를 위해 **스택(Stack)**과 **힙(Heap)**을 사용한다. 이 구조에서 각 변수와 객체가 저장되는 위치는 실행 컨텍스트와 환경 레코드에 의해 결정된다. 코드가 실행되면서 생성되는 변수와 객체는 힙에 저장된 환경 레코드를 통해 관리된다. 이 글에서는 JavaScript가 변수를 관리하고 메모리를 참조하는 방식을 정리했다.

#### 1. 메모리 구조: 스택과 힙
JavaScript 엔진은 두 가지 주요 메모리 구조를 통해 변수와 객체를 관리한다.

(1). 스택(Stack): 함수 호출과 실행 컨텍스트가 저장되는 메모리 영역이다. 빠르게 생성 및 제거가 가능하며, 실행 컨텍스트의 참조가 스택에 쌓인다.
(2). 힙(Heap): 크기가 가변적인 데이터, 즉 객체, 배열, 함수 및 모든 환경 레코드가 저장되는 메모리 공간이다.


#### 2. 실행 컨텍스트와 환경 레코드
JavaScript는 코드가 실행될 때마다 실행 컨텍스트를 생성하고, 이 컨텍스트는 변수와 함수의 정보가 담긴 환경 레코드를 포함한다. 환경 레코드는 객체 형태로 힙에 저장되며, 모든 변수는 이 환경 레코드를 통해 관리된다.

예를 들어 전역에서 변수가 선언된 경우, 전역 실행 컨텍스트의 환경 레코드가 힙에 저장되며, 이를 통해 변수에 접근하게 된다.

ex)
```js
var globalVar = 10;
let globalLet = 20;
const globalConst = 30;
```
위 코드에서 전역 변수들은 전역 환경 레코드에 등록되고, 이 레코드는 힙에 저장된다.

#### 3. 변수 선언 및 할당 과정
JavaScript에서 변수는 실행 컨텍스트 생성 시 환경 레코드에 등록되지만, 값은 코드가 실행될 때 할당된다.

**변수 선언:**
var는 생성 단계에서 undefined로 초기화되고 환경 레코드에 등록된다.
let과 const는 생성되지만 **초기화되지 않은 상태(TDZ)**로 남아 있으며, 환경 레코드에 등록만 된다.

**변수 할당:**
실행 단계에서 값이 할당된다. 기본 자료형(Primitive Types) 값도 힙에 저장된 환경 레코드에 저장되며, 참조 자료형(Reference Types) 값은 힙의 별도 메모리 블록에 저장된 후 해당 주소를 환경 레코드에 저장한다.

ex)
```js
let obj = { name: "Alice", age: 25 };
```
위 코드에서 obj 객체는 힙에 저장되고, obj라는 변수는 환경 레코드에서 힙의 주소를 참조로 저장하여 객체 데이터에 접근할 수 있게 된다.

#### 4. 메모리 접근 방식: 스택과 힙의 상호작용
변수는 스택에서 실행 컨텍스트를 통해 환경 레코드에 접근하고, 필요 시 환경 레코드가 참조하는 힙의 데이터를 확인한다.

(1). 스택에 쌓인 실행 컨텍스트는 각기 자신의 환경 레코드와 연결된다.
(2). 환경 레코드는 변수 이름과 해당 변수의 값(또는 참조 주소)을 저장한다.
(3).참조 자료형의 경우, 환경 레코드는 변수의 메모리 주소를 갖고 있고, 그 주소를 통해 힙에 저장된 객체 데이터에 접근한다.

이 구조 덕분에 JavaScript는 함수 호출이 많더라도 효율적으로 변수와 객체에 접근할 수 있다.


#### 5. 가비지 컬렉션과 메모리 관리
JavaScript는 자동으로 **가비지 컬렉션(Garbage Collection)**을 수행하여 사용되지 않는 메모리를 해제한다. 변수나 객체가 더 이상 참조되지 않으면 JavaScript 엔진은 이를 힙에서 제거해 메모리 낭비를 방지한다.


#### 결론
JavaScript에서 모든 변수는 궁극적으로 힙에 저장된 환경 레코드를 통해 관리된다. 기본 자료형과 참조 자료형 모두 환경 레코드의 일부로서 힙에 저장되므로, 결과적으로 모든 데이터가 힙을 통해 관리된다. 이러한 구조 덕분에 JavaScript는 메모리를 효율적으로 관리하며 코드 실행 시 일관된 접근 방식을 유지할 수 있다.



